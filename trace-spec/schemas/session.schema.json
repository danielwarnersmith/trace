{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Session",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "created_at",
    "updated_at",
    "status",
    "start_time",
    "timeline_path",
    "markers_path",
    "transcript_path",
    "voice_notes_path",
    "digest_path",
    "media"
  ],
  "properties": {
    "id": { "$ref": "#/$defs/ulid" },
    "title": { "type": "string" },
    "created_at": { "$ref": "#/$defs/rfc3339" },
    "updated_at": { "$ref": "#/$defs/rfc3339" },
    "status": { "type": "string", "enum": ["active", "closed"] },
    "start_time": { "$ref": "#/$defs/rfc3339" },
    "end_time": { "$ref": "#/$defs/rfc3339" },
    "duration_ms": { "$ref": "#/$defs/duration_ms" },
    "timeline_path": { "type": "string", "const": "timeline.jsonl" },
    "markers_path": { "type": "string", "const": "markers.jsonl" },
    "transcript_path": {
      "anyOf": [
        { "type": "null" },
        { "type": "string", "const": "transcript.jsonl" }
      ]
    },
    "voice_notes_path": {
      "anyOf": [
        { "type": "null" },
        { "type": "string", "const": "voice_notes.jsonl" }
      ]
    },
    "digest_path": {
      "anyOf": [
        { "type": "null" },
        { "type": "string", "const": "digest.md" }
      ]
    },
    "transcribed_at": { "$ref": "#/$defs/rfc3339" },
    "digest_updated_at": { "$ref": "#/$defs/rfc3339" },
    "media": {
      "type": "array",
      "items": { "$ref": "#/$defs/media_item" }
    }
  },
  "$defs": {
    "ulid": {
      "type": "string",
      "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$"
    },
    "rfc3339": {
      "type": "string",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]+)?Z$"
    },
    "duration_ms": {
      "type": "integer",
      "minimum": 0
    },
    "media_item": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "kind", "path", "mime", "created_at", "start_offset_ms"],
      "properties": {
        "id": { "$ref": "#/$defs/ulid" },
        "kind": {
          "type": "string",
          "enum": ["audio", "video", "screen", "other"]
        },
        "path": {
          "type": "string",
          "pattern": "^media/"
        },
        "mime": { "type": "string" },
        "created_at": { "$ref": "#/$defs/rfc3339" },
        "start_offset_ms": { "$ref": "#/$defs/duration_ms" },
        "duration_ms": { "$ref": "#/$defs/duration_ms" }
      }
    }
  }
}
